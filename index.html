<!DOCTYPE html>
<html lang="pt-PT">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Por Famalicão</title>
    <meta name="description" content="Por Famalicão - Unir Gerações, Construir Soluções.">
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-GGMKSV2EBF"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-GGMKSV2EBF');
</script>

<body>
    <!-- Navigation -->
    <!-- Navigation -->
    <nav class="navbar">
          <div class="nav-container">
              <div class="nav-logo">
                  <a href="/">
                      <img src="/image/logo.png" alt="Por Famalicão" style="max-width:120px; height:auto;">
                  </a>
            </div>
            <div class="nav-menu" id="nav-menu">
                <a href="/candidatura/" class="nav-link">Candidatura</a>
                <a href="/equipas/" class="nav-link">Quem Somos</a>
                <a href="/programaeleitoral/" class="nav-link">Programa Eleitoral</a>
                <a href="/transparencia/" class="nav-link">Transparência</a>
                <a href="/galeria/" class="nav-link">Galeria</a>
                <a href="/contactos/" class="nav-link">Contactos</a>
            </div>
            <div class="nav-hamburger" id="nav-hamburger">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="hero">
        <div class="hero-content">
            <h1>Unir Gerações, Construir Soluções</h1>
            <div class="hero-video-container">
                <div class="video-placeholder">
                    <!-- Substitui a imagem pelo vídeo -->
                    <video width="100%" height="auto" controls autoplay muted>
                        <source src="/image/VIDEOFINAL_PEDRO_normal (1).mp4" type="video/mp4">
                        O seu navegador não suporta vídeo.
                    </video>
                </div>
            </div>
            <!--<div class="hero-actions">
                <a href="programa.html" class="btn btn-primary">Conhecer Programa</a>
            </div>-->
        </div>
    </section>

    <!-- Features Section -->
    <section class="features">
        <div class="container">
            <h2>Os Nossos Pilares</h2>
            <div class="features-grid">
                <div class="feature-card">
                    <div class="feature-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" viewBox="0 0 24 24"><path fill="currentColor" d="m12 .44l10 3.5V12c0 4.127-2.534 7.012-4.896 8.803a19.744 19.744 0 0 1-4.65 2.595a6.99 6.99 0 0 1-.087.033l-.025.009l-.007.002l-.003.001c-.001 0-.002 0-.332-.943l-.331.944h-.001l-.003-.002l-.007-.002l-.025-.01a12.165 12.165 0 0 1-.398-.155a19.749 19.749 0 0 1-4.34-2.473C4.535 19.013 2 16.128 2 12.001V3.94l10-3.5Zm0 22.06l-.331.944l.331.116l.331-.116L12 22.5Zm0-1.072l.009-.004a17.755 17.755 0 0 0 3.887-2.215C18.034 17.59 20 15.223 20 12V5.36l-8-2.8l-8 2.8V12c0 3.223 1.966 5.588 4.104 7.21A17.75 17.75 0 0 0 12 21.427Zm6.072-13.085l-7.071 7.071l-4.243-4.242l1.415-1.415L11 12.586l5.657-5.657l1.414 1.414Z"/></svg>
                    </div>
                    <h3>Transparência</h3>
                    <p>Gestão clara dos recursos da freguesia, com informação acessível e prestação de contas regular a todos os cidadãos.</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" viewBox="0 0 56 56"><path fill="currentColor" d="M28 27.126c3.194 0 5.941-2.852 5.941-6.566c0-3.669-2.762-6.387-5.941-6.387s-5.942 2.778-5.942 6.417c0 3.684 2.748 6.536 5.942 6.536m-17.097.341c2.763 0 5.17-2.495 5.17-5.718c0-3.194-2.422-5.556-5.17-5.556c-2.763 0-5.199 2.421-5.184 5.585c0 3.194 2.406 5.69 5.184 5.69m34.194 0c2.778 0 5.184-2.495 5.184-5.689c0-3.164-2.421-5.585-5.184-5.585c-2.748 0-5.17 2.362-5.17 5.555c0 3.224 2.407 5.72 5.17 5.72M2.614 40.881h11.29c-1.545-2.243.341-6.759 3.535-9.225c-1.65-1.099-3.773-1.916-6.55-1.916C4.188 29.74 0 34.686 0 38.801c0 1.337.743 2.08 2.614 2.08m50.772 0c1.886 0 2.614-.743 2.614-2.08c0-4.115-4.189-9.061-10.888-9.061c-2.778 0-4.902.817-6.55 1.916c3.193 2.466 5.08 6.982 3.535 9.225Zm-34.73 0h18.672c2.332 0 3.164-.669 3.164-1.976c0-3.832-4.798-9.12-12.507-9.12c-7.694 0-12.492 5.288-12.492 9.12c0 1.307.832 1.976 3.164 1.976"/></svg>
                    </div>
                    <h3>Proximidade</h3>
                    <p>Disponibilidade constante para ouvir e estar junto da população, valorizando a participação ativa de cada lugar da freguesia.</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" viewBox="0 0 32 32"><path fill="currentColor" d="M4 4v24h24V12.187l-2 2V26H6V6h19.813l2-2H4zm23.28 3.28L16 18.563l-4.28-4.28l-1.44 1.437l5 5l.72.686l.72-.687l12-12l-1.44-1.44z"/></svg>
                    </div>
                    <h3>Compromisso</h3>
                    <p>Trabalho sério e consistente, garantindo que as decisões tomadas têm impacto real no desenvolvimento de Famalicão.</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" viewBox="0 0 32 32"><path fill="currentColor" d="M21.57 27.75A12.885 12.885 0 0 1 16 29C8.832 29 3 23.168 3 16c0-3.075 1.057-5.979 3-8.308V10h2V4H2v2h2.842A14.861 14.861 0 0 0 1 16c0 8.271 6.729 15 15 15a14.87 14.87 0 0 0 6.43-1.444l-.86-1.806Z"/><path fill="currentColor" d="M21 9c-3.16 0-5.752 2.457-5.978 5.56A5.971 5.971 0 0 0 11 13H7v4c0 3.309 2.692 6 6 6h2v4h2v-8h2c3.308 0 6-2.691 6-6V9h-4Zm-8 12c-2.206 0-4-1.794-4-4v-2h2c2.206 0 4 1.794 4 4v.586l-2.293-2.293l-1.414 1.414L13.586 21H13Zm10-8c0 2.206-1.794 4-4 4h-.586l2.293-2.293l-1.414-1.414L17 15.586V15c0-2.206 1.794-4 4-4h2v2Z"/><path fill="currentColor" d="M31 16c0-8.271-6.729-15-15-15a14.87 14.87 0 0 0-6.43 1.444l.86 1.806A12.885 12.885 0 0 1 16 3c7.168 0 13 5.832 13 13c0 3.075-1.057 5.979-3 8.308V22h-2v6h6v-2h-2.842A14.861 14.861 0 0 0 31 16Z"/></svg>
                    </div>
                    <h3>Sustentabilidade</h3>
                    <p>Planeamento responsável que assegura a preservação ambiental, o equilíbrio financeiro e a qualidade de vida das gerações futuras.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- News Section 
    <section class="news">
        <div class="container">
            <div class="section-header">
                <h2>Últimas Notícias</h2>
                <a href="noticias.html" class="btn btn-outline">Ver Todas</a>
            </div>
            <div class="news-grid">
                <article class="news-card">
                    <img src="https://images.pexels.com/photos/6457524/pexels-photo-6457524.jpeg?auto=compress&cs=tinysrgb&w=400" alt="Notícia">
                    <div class="news-content">
                        <span class="news-date">15 Nov 2025</span>
                        <h3>Apresentação do Programa Eleitoral</h3>
                        <p>O nosso programa eleitoral foi apresentado oficialmente, destacando as principais propostas para os próximos 4 anos.</p>
                        <a href="#" class="news-link">Ler mais</a>
                    </div>
                </article>
                <article class="news-card">
                    <img src="https://images.pexels.com/photos/6457520/pexels-photo-6457520.jpeg?auto=compress&cs=tinysrgb&w=400" alt="Notícia">
                    <div class="news-content">
                        <span class="news-date">12 Nov 2025</span>
                        <h3>Reunião com Associações Locais</h3>
                        <p>Encontro produtivo com as associações locais para discutir as necessidades da comunidade.</p>
                        <a href="#" class="news-link">Ler mais</a>
                    </div>
                </article>
                <article class="news-card">
                    <img src="https://images.pexels.com/photos/6457517/pexels-photo-6457517.jpeg?auto=compress&cs=tinysrgb&w=400" alt="Notícia">
                    <div class="news-content">
                        <span class="news-date">10 Nov 2025</span>
                        <h3>Campanha de Rua Iniciada</h3>
                        <p>Começámos a nossa campanha de proximidade, visitando os diferentes bairros do concelho.</p>
                        <a href="#" class="news-link">Ler mais</a>
                    </div>
                </article>
            </div>
        </div>
    </section> -->

    <!-- CTA Section 
    <section class="cta">
        <div class="container">
            <h2>Juntos Construímos o Futuro</h2>
            <p>A sua participação é fundamental para transformar Famalicão. Contacte-nos e faça parte desta mudança.</p>
            <a href="contactos.html" class="btn btn-primary">Contactar</a>
        </div>
    </section> -->

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>Por Famalicão</h3>
                    <p>Unir Gerações, Construir Soluções.</p>
                    <div class="social-links">
                        <a href="https://www.facebook.com/porfamalicao" target="_blank" aria-label="Facebook">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 2.04c-5.5 0-10 4.49-10 10.02c0 5 3.66 9.15 8.44 9.9v-7H7.9v-2.9h2.54V9.85c0-2.51 1.49-3.89 3.78-3.89c1.09 0 2.23.19 2.23.19v2.47h-1.26c-1.24 0-1.63.77-1.63 1.56v1.88h2.78l-.45 2.9h-2.33v7a10 10 0 0 0 8.44-9.9c0-5.53-4.5-10.02-10-10.02Z"/>
                            </svg>
                        </a>
                        <a href="https://www.instagram.com/porfamalicao/" target="_blank" aria-label="Instagram">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M12 0C8.74 0 8.333.015 7.053.072C5.775.132 4.905.333 4.14.63c-.789.306-1.459.717-2.126 1.384S.935 3.35.63 4.14C.333 4.905.131 5.775.072 7.053C.012 8.333 0 8.74 0 12s.015 3.667.072 4.947c.06 1.277.261 2.148.558 2.913a5.885 5.885 0 0 0 1.384 2.126A5.868 5.868 0 0 0 4.14 23.37c.766.296 1.636.499 2.913.558C8.333 23.988 8.74 24 12 24s3.667-.015 4.947-.072c1.277-.06 2.148-.262 2.913-.558a5.898 5.898 0 0 0 2.126-1.384a5.86 5.86 0 0 0 1.384-2.126c.296-.765.499-1.636.558-2.913c.06-1.28.072-1.687.072-4.947s-.015-3.667-.072-4.947c-.06-1.277-.262-2.149-.558-2.913a5.89 5.89 0 0 0-1.384-2.126A5.847 5.847 0 0 0 19.86.63c-.765-.297-1.636-.499-2.913-.558C15.667.012 15.26 0 12 0zm0 2.16c3.203 0 3.585.016 4.85.071c1.17.055 1.805.249 2.227.415c.562.217.96.477 1.382.896c.419.42.679.819.896 1.381c.164.422.36 1.057.413 2.227c.057 1.266.07 1.646.07 4.85s-.015 3.585-.074 4.85c-.061 1.17-.256 1.805-.421 2.227a3.81 3.81 0 0 1-.899 1.382a3.744 3.744 0 0 1-1.38.896c-.42.164-1.065.36-2.235.413c-1.274.057-1.649.07-4.859.07c-3.211 0-3.586-.015-4.859-.074c-1.171-.061-1.816-.256-2.236-.421a3.716 3.716 0 0 1-1.379-.899a3.644 3.644 0 0 1-.9-1.38c-.165-.42-.359-1.065-.42-2.235c-.045-1.26-.061-1.649-.061-4.844c0-3.196.016-3.586.061-4.861c.061-1.17.255-1.814.42-2.234c.21-.57.479-.96.9-1.381c.419-.419.81-.689 1.379-.898c.42-.166 1.051-.361 2.221-.421c1.275-.045 1.65-.06 4.859-.06l.045.03zm0 3.678a6.162 6.162 0 1 0 0 12.324a6.162 6.162 0 1 0 0-12.324zM12 16c-2.21 0-4-1.79-4-4s1.79-4 4-4s4 1.79 4 4s-1.79 4-4 4zm7.846-10.405a1.441 1.441 0 0 1-2.88 0a1.44 1.44 0 0 1 2.88 0z"/>                            </svg>
                        </a>
                        <a href="https://wa.me/351960400494" target="_blank" aria-label="WhatsApp">
                            <svg width="28" height="28" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M16.6 14c-.2-.1-1.5-.7-1.7-.8c-.2-.1-.4-.1-.6.1c-.2.2-.6.8-.8 1c-.1.2-.3.2-.5.1c-.7-.3-1.4-.7-2-1.2c-.5-.5-1-1.1-1.4-1.7c-.1-.2 0-.4.1-.5c.1-.1.2-.3.4-.4c.1-.1.2-.3.2-.4c.1-.1.1-.3 0-.4c-.1-.1-.6-1.3-.8-1.8c-.1-.7-.3-.7-.5-.7h-.5c-.2 0-.5.2-.6.3c-.6.6-.9 1.3-.9 2.1c.1.9.4 1.8 1 2.6c1.1 1.6 2.5 2.9 4.2 3.7c.5.2.9.4 1.4.5c.5.2 1 .2 1.6.1c.7-.1 1.3-.6 1.7-1.2c.2-.4.2-.8.1-1.2l-.4-.2m2.5-9.1C15.2 1 8.9 1 5 4.9c-3.2 3.2-3.8 8.1-1.6 12L2 22l5.3-1.4c1.5.8 3.1 1.2 4.7 1.2c5.5 0 9.9-4.4 9.9-9.9c.1-2.6-1-5.1-2.8-7m-2.7 14c-1.3.8-2.8 1.3-4.4 1.3c-1.5 0-2.9-.4-4.2-1.1l-.3-.2l-3.1.8l.8-3l-.2-.3c-2.4-4-1.2-9 2.7-11.5S16.6 3.7 19 7.5c2.4 3.9 1.3 9-2.6 11.4"/>
                            </svg>                        
                        </a>
                    </div>
                </div>
                <div class="footer-section">
                    <h4>Navegação</h4>
                    <ul>
                        <li><a href="/candidatura/">Candidatura</a></li>
                        <li><a href="/equipas/">Quem Somos</a></li>
                        <li><a href="/programaeleitoral/">Programa Eleitoral</a></li>
                        <li><a href="/transparencia/">Transparência</a></li>
                        <li><a href="/galeria/">Galeria</a></li>
                        <li><a href="/contactos/">Contactos</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>Contactos</h4>
                    <p>
                        <a href="mailto:apoio@porfamalicao.pt" style="color:inherit;text-decoration:none;">
                        apoio@porfamalicao.pt
                    </a>
                    </p>
                    <p>
                        <a href="tel:+351960400494" style="color:inherit;text-decoration:none;">
                        +351 960 400 494
                        </a>
                    </p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 Por Famalicão. Todos os direitos reservados.</p>
            </div>
        </div>
    </footer>




    <!-- === Chat Por Famalicão – widget flutuante (n8n Chat URL) === 
<style>
  :root{
    /* paleta Por Famalicão */
    --pf-primary:#002571;
    --pf-primary-dark:#001a56;
    --pf-secondary:#003399;
    --pf-soft:#f3f6fb;
    --pf-border:#e1e5f0;
    --pf-text:#1f2937;
    --pf-muted:#6b7280;

    /* mapeamento para o chat */
    --chat-accent:var(--pf-primary);
    --chat-accent-dark:var(--pf-primary-dark);
    --chat-bg:#ffffff;
    --chat-text:var(--pf-text);
    --chat-muted:var(--pf-muted);
    --shadow:0 14px 34px rgba(0,20,60,.15), 0 2px 6px rgba(0,20,60,.10);
    --radius:16px;
  }

  .pf-chat-launcher{
    position:fixed; right:18px; bottom:18px; z-index:9999;
    display:flex; align-items:center; gap:10px;
    background:var(--chat-accent); color:#fff; border-radius:999px;
    padding:12px 14px; box-shadow:var(--shadow); cursor:pointer;
    user-select:none; transition:transform .08s ease, filter .2s ease;
    font:600 14px/1.1 system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial;
  }
  .pf-chat-launcher:hover{transform:translateY(-1px); background:var(--chat-accent-dark);}
  .pf-chat-dot{width:10px;height:10px;background:#fff;border-radius:50%;box-shadow:0 0 0 3px rgba(255,255,255,.25) inset;}
  .pf-chat-badge{font-size:13px}

  .pf-chat-panel{
    position:fixed; right:18px; bottom:82px; z-index:9999;
    width:340px; max-height:70vh; background:var(--chat-bg); color:var(--chat-text);
    border-radius:var(--radius); box-shadow:var(--shadow); overflow:hidden; display:none;
    transform-origin:100% 100%; animation:pf-pop .18s ease forwards;
    border:1px solid var(--pf-border);
  }
  @keyframes pf-pop{from{transform:scale(.96);opacity:0}to{transform:scale(1);opacity:1}}
  @media (max-width:480px){.pf-chat-panel{right:10px; left:10px; width:auto; bottom:76px}}

  .pf-chat-header{
    display:flex; align-items:center; gap:10px; padding:12px 14px;
    background:linear-gradient(135deg,var(--pf-primary) 0%, var(--pf-secondary) 100%);
    color:#fff;
  }
  .pf-chat-avatar{
    width:28px;height:28px;border-radius:8px;background:#fff;
    color:var(--pf-primary);display:grid;place-items:center;font-weight:800
  }
  .pf-chat-title{font-weight:700;font-size:14px}
  .pf-chat-sub{font-size:12px;opacity:.9}
  .pf-chat-close{margin-left:auto;background:rgba(255,255,255,.16);border:0;color:#fff;width:30px;height:30px;border-radius:9px;cursor:pointer}

  .pf-chat-body{background:var(--pf-soft);padding:12px;height:320px;overflow:auto}
  .pf-tip{color:var(--chat-muted);font-size:12px;margin:6px 8px 8px}

  .pf-row{display:flex;gap:8px;align-items:flex-end}
  .pf-msg{
    max-width:78%;padding:10px 12px;border-radius:14px;margin:6px 0;
    word-wrap:break-word;white-space:pre-wrap
  }
  /* bolha do bot: branco com aro azul clarinho */
  .pf-bot{
    background:#fff;border:1px solid var(--pf-border);
    box-shadow:0 1px 0 rgba(0,20,60,.03);
  }
  /* bolha do utilizador: azul institucional */
  .pf-user{
    background:var(--pf-primary);color:#fff;margin-left:auto;
    box-shadow:0 2px 10px rgba(0,20,60,.18);
  }

  .pf-typing{display:none;color:var(--chat-muted);font-size:12px;padding:0 12px 8px}
  .pf-dots{display:inline-flex;gap:3px;vertical-align:middle}
  .pf-dots i{width:6px;height:6px;background:currentColor;border-radius:50%;display:block;animation:pf-dot 1s infinite ease-in-out}
  .pf-dots i:nth-child(2){animation-delay:.12s} .pf-dots i:nth-child(3){animation-delay:.24s}
  @keyframes pf-dot{0%,80%,100%{opacity:.25;transform:translateY(0)}40%{opacity:1;transform:translateY(-3px)}}

  .pf-inputbar{
    display:flex;gap:8px;align-items:center;padding:10px;background:#fff;border-top:1px solid var(--pf-border)
  }
  .pf-input{
    flex:1;border:1px solid var(--pf-border);border-radius:12px;padding:10px 12px;outline:none;background:#fff;
    font:500 14px/1.3 system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial;
    transition:border-color .15s ease, box-shadow .15s ease;
  }
  .pf-input:focus{
    border-color:var(--pf-primary);
    box-shadow:0 0 0 3px rgba(0,37,113,.12);
  }
  .pf-send{
    border:0;background:var(--pf-primary);color:#fff;border-radius:12px;height:38px;padding:0 14px;
    font-weight:700;cursor:pointer; transition:background .15s ease, transform .06s ease;
  }
  .pf-send:hover{ background:var(--pf-primary-dark) }
  .pf-send:disabled{opacity:.6;cursor:not-allowed}

  /* esconde linhas cujo balão esteja vazio */
  .pf-row:has(.pf-msg:empty){ display:none; }
</style>


<div class="pf-chat-launcher" id="pfLauncher" aria-label="Abrir chat">
  <span class="pf-chat-dot"></span>
  <span class="pf-chat-badge">Chat Por Famalicão</span>
</div>

<div class="pf-chat-panel" id="pfPanel" role="dialog" aria-label="Chat Por Famalicão" aria-modal="false">
  <div class="pf-chat-header">
    <div class="pf-chat-avatar"></div>
    <div>
      <div class="pf-chat-title">Por Famalicão</div>
      <div class="pf-chat-sub">chatbot</div>
    </div>
    <button class="pf-chat-close" id="pfClose" aria-label="Fechar">✕</button>
  </div>

  <div class="pf-chat-body" id="pfBody" aria-live="polite">
    <div class="pf-tip">👋 Olá! Como posso ajudar?</div>
    <div class="pf-row"><div class="pf-msg pf-bot">Escreve a tua pergunta abaixo e carrega em Enviar.</div></div>
  </div>

  <div class="pf-typing" id="pfTyping">a escrever <span class="pf-dots"><i></i><i></i><i></i></span></div>

  <div class="pf-inputbar">
    <input class="pf-input" id="pfInput" type="text" placeholder="Escreve aqui…" autocomplete="off" />
    <button class="pf-send" id="pfSend">Enviar</button>
  </div>
</div>

<script>
  /* === CONFIG === */
  // Troca para o Chat URL do teu nó "When chat message received" (termina em /chat)
  const CHAT_URL = "https://tiagocodinha.app.n8n.cloud/webhook/3c5a3e9d-f793-42ab-9690-7862c73f5672/chat";

  /* === refs UI === */
  const el = {
    launcher: document.getElementById('pfLauncher'),
    panel: document.getElementById('pfPanel'),
    close: document.getElementById('pfClose'),
    body: document.getElementById('pfBody'),
    input: document.getElementById('pfInput'),
    send: document.getElementById('pfSend'),
    typing: document.getElementById('pfTyping')
  };

  /* === sessão + histórico === */
  const STORAGE_KEY = 'pf_chat_history_v1';
  const SESSION_KEY = 'pf_chat_session_v1';

  const history = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');

  function uuidv4(){
    return ([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g, c =>
      (c ^ crypto.getRandomValues(new Uint8Array(1))[0] & 15 >> c/4).toString(16)
    );
  }
  function getSessionId(){
    let sid = localStorage.getItem(SESSION_KEY);
    if(!sid){ sid = uuidv4(); localStorage.setItem(SESSION_KEY, sid); }
    return sid;
  }
  function pushHistory(role, text){
    history.push({ role, text });
    localStorage.setItem(STORAGE_KEY, JSON.stringify(history));
  }

  function renderFromHistory(){
    if(!history.length) return;
    el.body.innerHTML = '';
    history.forEach(m => addMsg(m.role, m.text, false));
    el.body.scrollTop = el.body.scrollHeight;
  }

  /* === UI helpers === */
  function togglePanel(show){
    el.panel.style.display = show ? 'block' : 'none';
    if(show){ renderFromHistory(); setTimeout(()=>el.input.focus(), 50); }
  }
  function addMsg(role, text, persist=true){
    const row = document.createElement('div'); row.className = 'pf-row';
    const bubble = document.createElement('div');
    bubble.className = 'pf-msg ' + (role === 'user' ? 'pf-user' : 'pf-bot');
    bubble.textContent = text;
    row.appendChild(bubble);
    el.body.appendChild(row);
    el.body.scrollTop = el.body.scrollHeight;
    if(persist) pushHistory(role, text);
  }
  function setTyping(on){ el.typing.style.display = on ? 'block' : 'none'; }

  /* === chamada ao n8n (When chat message received) === */
  async function sendToN8N(text){
    const payload = {
      sessionId: getSessionId(),
      action: "sendMessage",
      chatInput: text
    };

    const res = await fetch(CHAT_URL, {
  method: "POST",
  headers: { "Content-Type": "application/json" },
  body: JSON.stringify({
    sessionId: getSessionId(),
    action: "sendMessage",
    chatInput: text
  })
});

// 1) tenta ler texto bruto
const raw = await res.text();

// 2) tenta fazer parse a JSON; se falhar, fica com o texto
let data = {};
try { data = JSON.parse(raw); } catch { /* fica raw */ }

const reply =
  data.chatOutput ||
  data.reply ||
  data.message ||
  (Array.isArray(data.messages) ? (data.messages.at(-1)?.content || data.messages.at(-1)?.text) : null) ||
  data.text ||
  raw ||                           // <- se vier texto simples, usa-o
  "Sem resposta do servidor.";

addMsg('bot', reply);
  }

  /* === enviar mensagem === */
  async function send(){
    const text = el.input.value.trim();
    if(!text) return;
    el.input.value = '';
    addMsg('user', text);

    try{
      el.send.disabled = true; setTyping(true);
      const reply = await sendToN8N(text);
      addMsg('bot', reply);
    }catch(err){
      console.error(err);
      addMsg('bot', '⚠️ Ocorreu um erro a comunicar com o servidor.');
    }finally{
      setTyping(false); el.send.disabled = false; el.input.focus();
    }
  }

  /* === eventos === */
  el.launcher.addEventListener('click', () => togglePanel(true));
  el.close.addEventListener('click', () => togglePanel(false));
  el.send.addEventListener('click', send);
  el.input.addEventListener('keydown', e => {
    if(e.key === 'Enter' && !e.shiftKey){ e.preventDefault(); send(); }
  });
  window.addEventListener('keydown', e => { if(e.key === 'Escape') togglePanel(false); });
</script>
 === /Chat Por Famalicão === -->




    <script src="script.js"></script>
</body>
</html>